(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.d({},{hi:()=>Q,lH:()=>X,xS:()=>K});var n=function(){function e(t){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},(n="checkResponse")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this.url=t.url,this.headers=t.headers}var n,r;return n=e,(r=[{key:"getProfileInformation",value:function(){return fetch("".concat(this.url,"/users/me"),{headers:this.headers}).then(this.checkResponse)}},{key:"editProfileInformation",value:function(e){return fetch("".concat(this.url,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then(this.checkResponse)}},{key:"editProfileAvatar",value:function(e){return fetch("".concat(this.url,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify(e)}).then(this.checkResponse)}},{key:"getCardsArray",value:function(){return fetch("".concat(this.url,"/cards"),{headers:this.headers}).then(this.checkResponse)}},{key:"addCardToServer",value:function(e){return fetch("".concat(this.url,"/cards"),{method:"POST",headers:this.headers,body:JSON.stringify(e)}).then(this.checkResponse)}},{key:"removeCardToServer",value:function(e){return fetch("".concat(this.url,"/cards/").concat(e),{headers:this.headers,method:"DELETE"}).then(this.checkResponse)}},{key:"addLike",value:function(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then(this.checkResponse)}},{key:"removeLike",value:function(e){return fetch("".concat(this.url,"/cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then(this.checkResponse)}}])&&t(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}(),r=(new n({url:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"f6f0e19f-3261-436f-8b67-2b9918fd933f","Content-Type":"application/json"}}),document.querySelector(".profile__name")),o=document.querySelector(".profile__contact-info"),i=document.querySelector(".profile__edit-button"),a=document.forms.profile_edit,c=a.elements.profile_name,u=a.elements.contact_info,s=a.elements.change_profile,l=document.querySelector(".profile__avatar-button"),f=document.forms.profile_avatar_edit.elements.change_avatar,p=document.querySelector(".popup__heading_place_image"),d=document.querySelector(".popup__image"),h=document.querySelector(".profile__add-button"),y=document.forms.add_card.elements.create_card;function _(e,t,n){t.textContent=e?"Сохранение...":n}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){var n=t.selectorUserName,r=t.selectorAboutSelf,o=t.selectorAvatar;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=document.querySelector(n),this._aboutSelf=document.querySelector(r),this._avatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){var e=this;return this.userInfo={},Q.getProfileInformation().then((function(t){e.userInfo.name=t.name,e.userInfo.about=t.about,e._name.textContent=t.name,e._aboutSelf.textContent=t.about})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})),this.userInfo}},{key:"addUserInfoToDom",value:function(e,t){this._name.textContent=e,this._aboutSelf.textContent=t}},{key:"addUserAvatarToDom",value:function(e){this._avatar.src=e}},{key:"setUserInfo",value:function(e){var t=this;_(!0,s),Q.editProfileInformation({name:e.profile_name,about:e.contact_info}).then((function(e){s.classList.add("popup__button_disabled"),s.disabled="disabled",t.addUserInfoToDom(e.name,e.about)})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return _(!1,s,"Сохранить")}))}},{key:"setUserAvatar",value:function(e){var t=this;_(!0,f),Q.editProfileAvatar({avatar:e.profile_image}).then((function(e){f.classList.add("popup__button_disabled"),f.disabled="disabled",t.addUserAvatarToDom(e.avatar)})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return _(!1,f,"Сохранить")}))}}])&&v(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"_нandleButtonClose",(function(){n.close()})),k(this,"_нandleEscClose",(function(e){"Escape"===e.key&&n.close()})),k(this,"_handleOverlayClose",(function(e){e.target.classList.contains("popup_opened")&&n.close()})),this._popup=document.querySelector(t),this._buttonPopupClose=this._popup.querySelector(".popup__close")}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),this.setEventListeners()}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),this.removeEventListeners()}},{key:"setEventListeners",value:function(){this._buttonPopupClose.addEventListener("click",this._нandleButtonClose),document.addEventListener("keydown",this._нandleEscClose),document.addEventListener("mousedown",this._handleOverlayClose)}},{key:"removeEventListeners",value:function(){this._buttonPopupClose.removeEventListener("click",this._нandleButtonClose),document.removeEventListener("keydown",this._нandleEscClose),document.removeEventListener("mousedown",this._handleOverlayClose)}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(){return C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=P(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},C.apply(this,arguments)}function P(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}function E(e,t){return E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},E(e,t)}function O(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return j(e)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=L(r);if(o){var n=L(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return O(this,e)});function a(e){var t,n,r,o,c=e.selector,u=e.callback;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o=function(e){e.preventDefault(),t._callback(t._getInputValues()),t.close()},(r="_formSubmit")in(n=j(t=i.call(this,c)))?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,t._callback=u,t._form=t._popup.querySelector(".popup__form"),t}return t=a,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._form.querySelectorAll(".popup__item"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){C(L(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._formSubmit)}},{key:"close",value:function(){C(L(a.prototype),"close",this).call(this),this._form.reset()}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(g);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(){return A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=x(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},A.apply(this,arguments)}function x(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function U(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(r);if(o){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return U(this,e)});function a(){return I(this,a),i.apply(this,arguments)}return t=a,(n=[{key:"open",value:function(e,t){A(D(a.prototype),"open",this).call(this),p.textContent=e,d.alt=e,d.src=t}}])&&R(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(g);function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var H=function(){function e(t,n){var r=t.validationConfig;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=n,this._inputSelector=r.inputSelector,this._submitButtonSelector=r.submitButtonSelector,this._inactiveButtonClass=r.inactiveButtonClass,this._inputErrorClass=r.inputErrorClass}var t,n;return t=e,(n=[{key:"_showError",value:function(e,t){t.classList.add(this._inputErrorClass),e.textContent=t.validationMessage}},{key:"_hideError",value:function(e,t){t.classList.remove(this._inputErrorClass),e.textContent=t.validationMessage}},{key:"_checkInputValidity",value:function(e,t){var n=e.validity.valid,r=t.querySelector("#".concat(e.id,"-error"));n?this._hideError(r,e):this._showError(r,e)}},{key:"_activateSubmitButton",value:function(e,t){t?(e.classList.remove(this._inactiveButtonClass),e.disabled=!1):(e.classList.add(this._inactiveButtonClass),e.disabled="disabled")}},{key:"_setEventListner",value:function(e){var t=this,n=Array.from(e.querySelectorAll(this._inputSelector)),r=e.querySelector(this._submitButtonSelector);n.forEach((function(n){n.addEventListener("input",(function(){t._checkInputValidity(n,e),t._activateSubmitButton(r,e.checkValidity())}))}))}},{key:"enableValidation",value:function(){var e=this;document.querySelectorAll(this._formSelector).forEach((function(t){e._setEventListner(t)}))}}])&&N(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),M(this,"_openPopupImage",(function(){X.open(r._name,r._link)})),M(this,"_cardReaction",(function(e){var t=r._card.querySelector(".card__like-quantity");e.target.classList.contains("card__reaction_active")?Q.removeLike(r._id).then((function(n){t.textContent=n.likes.length,e.target.classList.remove("card__reaction_active")})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})):Q.addLike(r._id).then((function(n){t.textContent=n.likes.length,e.target.classList.add("card__reaction_active")})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}))})),M(this,"_removeCard",(function(){Q.removeCardToServer(r._id).then((function(){r._card.remove()})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}))})),this._name=t.name,this._link=t.link,this._likes=t.likes,this._owner=t.owner,this._selector=n,this._id=t._id}var t,n;return t=e,(n=[{key:"_getTemplateCard",value:function(){return document.querySelector(this._selector).content.querySelector(".card").cloneNode(!0)}},{key:"generateCard",value:function(){return this._card=this._getTemplateCard(),this._handleAddBasket(),this._findUserLikes(),this.setEventListeners(),this._card.querySelector(".card__name").textContent=this._name,this._card.querySelector(".card__image").alt=this._name,this._card.querySelector(".card__image").src=this._link,this._card.querySelector(".card__like-quantity").textContent=this._likes.length,this._card}},{key:"_handleAddBasket",value:function(){this._owner._id===K&&this._card.querySelector(".card__remove").classList.add("card__remove_active")}},{key:"_findUserLikes",value:function(){this._likes.find((function(e){return e._id===K}))&&this._card.querySelector(".card__reaction").classList.add("card__reaction_active")}},{key:"setEventListeners",value:function(){this._card.querySelector(".card__reaction").addEventListener("click",this._cardReaction),this._card.querySelector(".card__image").addEventListener("click",this._openPopupImage),this._card.querySelector(".card__remove").addEventListener("click",this._removeCard)}}])&&J(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var F=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this._selectorContainer=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(){var e=this;this._items.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(e,t){"append"===t?this._selectorContainer.append(e):this._selectorContainer.prepend(e)}}])&&$(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K="";new H({validationConfig:{inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_error"}},".popup__form").enableValidation();var Q=new n({url:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"f6f0e19f-3261-436f-8b67-2b9918fd933f","Content-Type":"application/json"}}),W=new m({selectorUserName:".profile__name",selectorAboutSelf:".profile__contact-info",selectorAvatar:".profile__image"});Promise.all([Q.getProfileInformation(),Q.getCardsArray()]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];K=o._id,W.addUserInfoToDom(o.name,o.about),W.addUserAvatarToDom(o.avatar);var a=new F({items:i,renderer:function(e){var t=new z(e,"#card-template").generateCard();a.addItem(t,"append")}},".cards__content");a.renderItems()})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}));var X=new V("#popup_image"),Y=new q({selector:"#popup_avatar",callback:function(e){W.setUserAvatar(e)}}),Z=new q({selector:"#popup_profile",callback:function(e){W.setUserInfo(e)}}),ee=new q({selector:"#popup_card",callback:function(e){_(!0,y),Q.addCardToServer({link:e.place_adres,name:e.place_name}).then((function(e){var t=new z(e,"#card-template").generateCard();new F({items:[]},".cards__content").addItem(t)})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return _(!1,y,"Создать")}))}});l.addEventListener("click",(function(){Y.open()})),i.addEventListener("click",(function(){c.value=r.textContent,u.value=o.textContent,Z.open()})),h.addEventListener("click",(function(){ee.open()}))})();