(()=>{"use strict";function e(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)}function t(e){var t=document.querySelector(".card_target_delete");t&&t.classList.remove("card_target_delete"),e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(n){(n.target.classList.contains("popup_opened")||n.target.classList.contains("popup__close"))&&t(e)}))}));var c=document.querySelector(".profile__edit-button"),r=document.querySelector("#popup_profile"),o=document.querySelector(".cards__content"),a=document.querySelector(".profile__avatar-button"),i=document.querySelector("#popup_avatar"),u=document.querySelector(".profile__add-button"),s=document.querySelector("#popup_card"),d=document.querySelector("#popup_image"),l=document.querySelector(".popup__image"),f=(document.querySelector("#popup_delete"),document.querySelector(".popup__heading_place_image")),p=document.querySelector(".profile__name"),_=document.querySelector(".profile__contact-info"),m=document.querySelector(".profile__image"),h=document.forms.profile_edit,v=h.elements.profile_name,y=h.elements.contact_info,S=h.elements.change_profile,b=document.forms.profile_avatar_edit,L=b.elements.profile_image,q=b.elements.change_avatar,E=document.forms.add_card,g=E.elements.place_adres,k=E.elements.place_name,C=E.elements.create_card,x=(document.forms.delete_card,{url:"https://nomoreparties.co/v1/plus-cohort-8",headers:{Authorization:"f6f0e19f-3261-436f-8b67-2b9918fd933f","Content-type":"application/json"}}),P=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function j(t){var n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=n.querySelector(".card__image"),r=n.querySelector(".card__name"),o=n.querySelector(".card__reaction"),a=n.querySelector(".card__remove"),i=n.querySelector(".card__like-quantity");return r.textContent=t.name,c.src=t.link,c.alt=t.name,i.textContent=t.likes.length,"c80d39249f04c8d4745b6228"===t.owner._id&&a.classList.add("card__remove_active"),t.likes.find((function(e){return"c80d39249f04c8d4745b6228"===e._id}))&&o.classList.add("card__reaction_active"),c.addEventListener("click",(function(){e(d),l.src=t.link,l.alt=t.name,f.textContent=t.name})),o.addEventListener("click",(function(e){var n;e.target.classList.contains("card__reaction_active")?(e.target.classList.remove("card__reaction_active"),(n=t._id,fetch("".concat(x.url,"/cards/likes/").concat(n),{method:"DELETE",headers:x.headers}).then(P)).then((function(e){i.textContent=e.likes.length})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}))):(e.target.classList.add("card__reaction_active"),function(e){return fetch("".concat(x.url,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then(P)}(t._id).then((function(e){i.textContent=e.likes.length})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})))})),a.addEventListener("click",(function(){var e;(e=t._id,fetch("".concat(x.url,"/cards/").concat(e),{headers:x.headers,method:"DELETE"}).then(P)).then((function(e){n.remove()})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))}))})),n}function A(e,t,n){t.textContent=e?"Сохранение...":n}function T(e,t){p.textContent=e,_.textContent=t}fetch("".concat(x.url,"/users/me"),{headers:x.headers}).then(P).then((function(e){T(e.name,e.about),m.src=e.avatar})),fetch("".concat(x.url,"/cards"),{headers:x.headers}).then(P).then((function(e){e.forEach((function(e){o.append(j(e))}))})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){var c=e.validity.valid,r=t.querySelector("#".concat(e.id,"-error"));c?function(e,t,n){t.classList.remove(n.inputErrorClass),e.textContent=t.validationMessage}(r,e,n):function(e,t,n){t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(r,e,n)}(n,e,t),function(e,t,n){t?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled="disabled")}(c,e.checkValidity(),t)}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_error"}),a.addEventListener("click",(function(){e(i)})),c.addEventListener("click",(function(){v.value=p.textContent,y.value=_.textContent,e(r)})),u.addEventListener("click",(function(){e(s)})),h.addEventListener("submit",(function(e){var n;e.preventDefault(),A(!0,S),(n={name:v.value,about:y.value},fetch("".concat(x.url,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify(n)}).then(P)).then((function(e){T(e.name,e.about),t(r)})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return A(!1,S,"Сохранить")}))})),b.addEventListener("submit",(function(e){var n;e.preventDefault(),A(!0,q),(n={avatar:L.value},fetch("".concat(x.url,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify(n)}).then(P)).then((function(e){m.src=e.avatar,t(i),q.classList.add("popup__button_disabled"),q.disabled="disabled",b.reset()})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return A(!1,q,"Сохранить")}))})),E.addEventListener("submit",(function(e){var n;e.preventDefault(),A(!0,C),(n={link:g.value,name:k.value},fetch("".concat(x.url,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify(n)}).then(P)).then((function(e){o.prepend(j(e)),t(s),C.classList.add("popup__button_disabled"),C.disabled="disabled",E.reset()})).catch((function(e){return Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){return A(!1,C,"Создать")}))}))})();